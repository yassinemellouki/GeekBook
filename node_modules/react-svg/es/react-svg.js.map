{"version":3,"file":"react-svg.js","sources":["../src/shallow-differs.ts","../src/index.tsx"],"sourcesContent":["// Hat-tip: https://github.com/developit/preact-compat/blob/master/src/index.js#L402.\n\ninterface O {\n  [key: string]: any\n}\n\nconst shallowDiffers = (a: O, b: O) => {\n  for (const i in a) {\n    if (!(i in b)) {\n      return true\n    }\n  }\n\n  for (const i in b) {\n    if (a[i] !== b[i]) {\n      return true\n    }\n  }\n\n  return false\n}\n\nexport default shallowDiffers\n","import { Errback, EvalScripts, SVGInjector } from '@tanem/svg-injector'\nimport * as PropTypes from 'prop-types'\nimport * as React from 'react'\nimport ReactDOMServer from 'react-dom/server'\nimport shallowDiffers from './shallow-differs'\n\ntype WrapperType = HTMLSpanElement | HTMLDivElement\n\ninterface Props {\n  evalScripts?: EvalScripts\n  fallback?: React.ReactType\n  loading?: React.ReactType\n  onInjected?: Errback\n  renumerateIRIElements?: boolean\n  src: string\n  svgClassName?: string\n  svgStyle?: React.CSSProperties\n  wrapper?: 'div' | 'span'\n}\n\ninterface State {\n  hasError: boolean\n  isLoading: boolean\n}\n\nexport default class ReactSVG extends React.Component<\n  Props &\n    React.DetailedHTMLProps<React.HTMLAttributes<WrapperType>, WrapperType>,\n  State\n> {\n  static defaultProps = {\n    evalScripts: 'never',\n    fallback: null,\n    loading: null,\n    onInjected: () => undefined,\n    renumerateIRIElements: true,\n    svgClassName: null,\n    svgStyle: {},\n    wrapper: 'div'\n  }\n\n  static propTypes = {\n    evalScripts: PropTypes.oneOf(['always', 'once', 'never']),\n    fallback: PropTypes.oneOfType([\n      PropTypes.func,\n      PropTypes.object,\n      PropTypes.string\n    ]),\n    loading: PropTypes.oneOfType([\n      PropTypes.func,\n      PropTypes.object,\n      PropTypes.string\n    ]),\n    onInjected: PropTypes.func,\n    renumerateIRIElements: PropTypes.bool,\n    src: PropTypes.string.isRequired,\n    svgClassName: PropTypes.string,\n    svgStyle: PropTypes.object,\n    wrapper: PropTypes.oneOf(['div', 'span'])\n  }\n\n  initialState = {\n    hasError: false,\n    isLoading: true\n  }\n\n  state = this.initialState\n\n  // tslint:disable-next-line:variable-name\n  _isMounted = false\n\n  container?: WrapperType | null\n\n  svgWrapper?: WrapperType | null\n\n  refCallback = (container: WrapperType | null) => {\n    this.container = container\n  }\n\n  renderSVG() {\n    if (this.container instanceof Node) {\n      const {\n        evalScripts,\n        renumerateIRIElements,\n        src,\n        svgClassName,\n        svgStyle\n      } = this.props\n      const onInjected = this.props.onInjected!\n      const Wrapper = this.props.wrapper!\n\n      const wrapper = document.createElement(Wrapper)\n      wrapper.innerHTML = ReactDOMServer.renderToStaticMarkup(\n        <Wrapper>\n          <Wrapper className={svgClassName} data-src={src} style={svgStyle} />\n        </Wrapper>\n      )\n\n      this.svgWrapper = this.container.appendChild(\n        wrapper.firstChild as WrapperType\n      )\n\n      const each: Errback = (error, svg) => {\n        if (error) {\n          this.removeSVG()\n        }\n\n        // TODO: It'd be better to cleanly unsubscribe from SVGInjector\n        // callbacks instead of tracking a property like this.\n        if (this._isMounted) {\n          this.setState(\n            () => ({\n              hasError: !!error,\n              isLoading: false\n            }),\n            () => {\n              onInjected(error, svg)\n            }\n          )\n        }\n      }\n\n      SVGInjector(this.svgWrapper.firstChild as WrapperType, {\n        each,\n        evalScripts,\n        renumerateIRIElements\n      })\n    }\n  }\n\n  removeSVG() {\n    if (this.container instanceof Node && this.svgWrapper instanceof Node) {\n      this.container.removeChild(this.svgWrapper)\n      this.svgWrapper = null\n    }\n  }\n\n  componentDidMount() {\n    this._isMounted = true\n    this.renderSVG()\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    if (shallowDiffers(prevProps, this.props)) {\n      this.setState(\n        () => this.initialState,\n        () => {\n          this.removeSVG()\n          this.renderSVG()\n        }\n      )\n    }\n  }\n\n  componentWillUnmount() {\n    this._isMounted = false\n    this.removeSVG()\n  }\n\n  render() {\n    const {\n      evalScripts,\n      fallback: Fallback,\n      loading: Loading,\n      onInjected,\n      renumerateIRIElements,\n      src,\n      svgClassName,\n      svgStyle,\n      wrapper,\n      ...rest\n    } = this.props\n    const Wrapper = wrapper!\n\n    return (\n      <Wrapper {...rest} ref={this.refCallback}>\n        {this.state.isLoading && Loading && <Loading />}\n        {this.state.hasError && Fallback && <Fallback />}\n      </Wrapper>\n    )\n  }\n}\n"],"names":["shallowDiffers","a","b","i","ReactSVG","initialState","hasError","isLoading","state","_isMounted","container","svgWrapper","refCallback","renderSVG","Node","props","evalScripts","renumerateIRIElements","src","svgClassName","svgStyle","onInjected","Wrapper","wrapper","document","createElement","innerHTML","ReactDOMServer","renderToStaticMarkup","React.createElement","appendChild","firstChild","each","error","svg","removeSVG","setState","SVGInjector","removeChild","componentDidMount","componentDidUpdate","prevProps","componentWillUnmount","render","Fallback","fallback","Loading","loading","rest","React","defaultProps","undefined","propTypes","PropTypes","isRequired"],"mappings":"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"}